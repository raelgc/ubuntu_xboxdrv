# xboxdrv.conf
# Please, DO NOT EDIT THIS FILE. Edit /etc/defaults/xboxdrv

# Shortcut variable
env DEFAULT="/etc/default/xboxdrv"

# start parent service on boot
start on filesystem and RUNLEVEL [2345]

pre-start script
    # if udev rules already started instances, start
    # - service by doing nothing
    if [ $(pgrep -c xboxdrv) -gt 0 ] ; then
        exit 0;
    fi
    # remove existing joystick devices
    rm -f /dev/input/js*
    # source the source of our instance count
    if [ -f $DEFAULT ] ; then
        . $DEFAULT
    fi

    # get the number of controllers the user has defined
    # this is dynamic up to controller[x] in the default file
    INSTANCES=$( grep -c CONTROLLER._OPTIONS=. $DEFAULT )

    # start controller job instances with increasing IDs
    for INS in $( seq 1 $INSTANCES ) ; do
        exec start xboxdrv ID="$INS"
        sleep 0.2
    done
end script
